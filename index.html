<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cyber I Ching Reading</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
      font-family: "Noto Serif SC", serif;
      color: #222;
      text-align: center;
      padding: 50px;
    }
    button {
      font-size: 1.2em;
      padding: 0.6em 1.5em;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #animationBox {
      height: 200px;
      margin-bottom: 20px;
    }
    #result {
      margin-top: 2em;
      background: white;
      border-radius: 10px;
      padding: 20px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>I Ching Divination</h1>
  <p>Click the button below to cast two sets of trigrams and receive your hexagram.</p>
  <button onclick="startDivination()">Cast Hexagram</button>

  <div id="animationBox"></div>
  <div id="result"></div>

  <script>
const guaMap = {
  "111111": "乾为天",
  "000000": "坤为地",
  "010001": "水雷屯",
  "100010": "山水蒙",
  "010111": "水天需",
  "111010": "天水讼",
  "000010": "地水师",
  "010000": "水地比",
  "110111": "风天小畜",
  "111011": "天泽履",
  "000111": "地天泰",
  "111000": "天地否",
  "111001": "天火同人",
  "100111": "火天大有",
  "111100": "天雷无妄",
  "001111": "雷天大壮",
  "000100": "地泽临",
  "001000": "山地剥",
  "011001": "风水涣",
  "100110": "山泽损",
  "000011": "地火明夷",
  "110000": "雷地豫",
  "101111": "泽天夬",
  "111101": "天风姤",
  "000001": "泽地萃",
  "100000": "山天大畜",
  "100001": "山雷颐",
  "011110": "风泽中孚",
  "010100": "水火既济",
  "001010": "火水未济",
  "100101": "山泽损",
  "101001": "泽山咸",
  "001101": "雷风恒",
  "101100": "火雷噬嗑",
  "001110": "雷火丰",
  "011100": "火风鼎",
  "000110": "泽雷随",
  "011000": "山风蛊",
  "110001": "雷山小过",
  "100011": "山泽履",
  "111110": "天地否",
  "011111": "风火家人",
  "000101": "火泽睽",
  "101000": "泽火革",
  "100100": "火山旅",
  "001001": "山火贲",
  "011011": "泽水困",
  "110110": "雷水解",
  "001011": "山水蒙",
  "110100": "风水涣",
  "101101": "火水未济",
  "101011": "水火既济",
  "010110": "雷泽归妹",
  "011010": "泽雷随",
  "110010": "风山渐",
  "010011": "山风蛊",
  "110011": "风火家人",
  "001100": "雷泽归妹",
  "011101": "泽山咸",
  "101110": "火雷噬嗑"
};




    // 正确的动画帧路径：DumpStack.log.tmp0025 ~ tmp0059
    const coinAnimations = {
      "111": [],
      "110": [],
      "001": [],
      "000": []
    };

    for (let i = 25; i <= 59; i++) {
      const filename = `DumpStack.log.tmp${i.toString().padStart(4, '0')}.png`;
      coinAnimations["111"].push(`animation/111/${filename}`);
      coinAnimations["110"].push(`animation/110/${filename}`);
      coinAnimations["001"].push(`animation/001/${filename}`);
      coinAnimations["000"].push(`animation/000/${filename}`);
    }

    function flipCoin() {
      return Math.random() < 0.5 ? 0 : 1;
    }

    function getTrigramBinary() {
      let binary = "";
      for (let i = 0; i < 3; i++) {
        binary += flipCoin();
      }
      return binary;
    }

    function playAnimation(key, containerId = "animationBox", frameDelay = 100) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      const frames = coinAnimations[key];
      if (!frames) return;

      let index = 0;
      const img = document.createElement("img");
      img.style.maxHeight = "180px";
      container.appendChild(img);

      const interval = setInterval(() => {
        if (index >= frames.length) {
          clearInterval(interval);
        } else {
          img.src = frames[index];
          index++;
        }
      }, frameDelay);
    }

    function startDivination() {
      const resultBox = document.getElementById('result');
      const upper = getTrigramBinary();
      const lower = getTrigramBinary();
      const full = upper + lower;
      const guaName = guaMap[full] || "未知卦象";

      playAnimation(upper); // 上卦决定动画

      resultBox.innerHTML = `
        <p>Your upper trigram: <strong>${upper}</strong></p>
        <p>Your lower trigram: <strong>${lower}</strong></p>
        <p>Generated Hexagram: <strong>${guaName}</strong> (Binary: ${full})</p>
        <p>Consulting the Dao...</p>
      `;

      const prompt = `
Based on the following hexagram generated from digital coin tosses in an I Ching divination ritual, provide an accurate and traditional explanation from the Book of Changes:

- Upper trigram (binary): ${upper}
- Lower trigram (binary): ${lower}
- Combined hexagram (binary): ${full}
- Name of hexagram: ${guaName}

Please respond in the following structure:
1. 卦名 (standard Chinese hexagram name, e.g., 泽水困)
2. 卦义 (Traditional Chinese interpretation of this hexagram, accurate and concise)
3. Modern Advice (a short, practical takeaway or mindset reflection for today, based on this hexagram's meaning)

Do not invent new hexagrams or interpret freely. Your answer must be grounded in traditional I Ching scholarship. Your answer should be in English.
`;

      puter.ai.chat(prompt).then((reply) => {
        resultBox.innerHTML += `
          <hr>
          <div style="text-align: left; white-space: pre-wrap;">${reply}</div>
        `;
      });
    }
  </script>
</body>
</html>
